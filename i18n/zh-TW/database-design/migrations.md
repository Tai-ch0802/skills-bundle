# 遷移原則

> 零停機變更的安全遷移策略。

## 安全遷移策略

```
零停機變更：
│
├── 新增欄位
│   └── 以可 null 新增 → 回填 → 加 NOT NULL
│
├── 移除欄位
│   └── 停止使用 → 部署 → 移除欄位
│
├── 新增索引
│   └── CREATE INDEX CONCURRENTLY（不阻塞）
│
└── 重新命名欄位
    └── 新增新的 → 遷移資料 → 部署 → 刪除舊的
```

## 遷移哲學

- 永遠不要一步做破壞性變更
- 先在資料副本上測試遷移
- 有回滾計畫
- 盡可能在交易中執行

## 無伺服器資料庫

### Neon（無伺服器 PostgreSQL）

| 功能 | 好處 |
|------|------|
| 縮放到零 | 節省成本 |
| 即時分支 | 開發/預覽 |
| 完整 PostgreSQL | 相容性 |
| 自動擴展 | 流量處理 |

### Turso（Edge SQLite）

| 功能 | 好處 |
|------|------|
| Edge 位置 | 超低延遲 |
| SQLite 相容 | 簡單 |
| 慷慨免費方案 | 成本 |
| 全球分佈 | 效能 |
