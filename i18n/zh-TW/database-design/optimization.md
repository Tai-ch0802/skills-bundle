# 查詢最佳化

> N+1 問題、EXPLAIN ANALYZE、最佳化優先順序。

## N+1 問題

```
什麼是 N+1？
├── 1 個查詢取得父記錄
├── N 個查詢取得關聯記錄
└── 非常慢！

解決方案：
├── JOIN → 單一查詢取得所有資料
├── 預先載入 → ORM 處理 JOIN
├── DataLoader → 批次和快取（GraphQL）
└── 子查詢 → 一個查詢取得關聯
```

## 查詢分析心態

```
最佳化前：
├── EXPLAIN ANALYZE 查詢
├── 尋找 Seq Scan（全表掃描）
├── 檢查實際 vs 預估行數
└── 識別缺少的索引
```

## 最佳化優先順序

1. **新增缺少的索引**（最常見問題）
2. **僅選取需要的欄位**（非 SELECT *）
3. **使用正確的 JOIN**（盡可能避免子查詢）
4. **儘早限制**（資料庫層級的分頁）
5. **快取**（適當時）
