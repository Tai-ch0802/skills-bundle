# Schema 設計原則

> 正規化、主鍵、時間戳、關聯。

## 正規化決策

```
何時正規化（分開資料表）：
├── 資料在各行間重複
├── 更新需要多處修改
├── 關聯明確
└── 查詢模式受益

何時反正規化（嵌入/重複）：
├── 讀取效能關鍵
├── 資料很少變更
├── 總是一起抓取
└── 需要更簡單的查詢
```

## 主鍵選擇

| 類型 | 適用時機 |
|------|----------|
| **UUID** | 分散式系統、安全性 |
| **ULID** | UUID + 按時間排序 |
| **自動遞增** | 簡單應用、單一資料庫 |
| **自然鍵** | 很少（具有業務意義）|

## 時間戳策略

```
每個資料表：
├── created_at → 建立時間
├── updated_at → 最後修改
└── deleted_at → 軟刪除（如需要）

使用 TIMESTAMPTZ（含時區）而非 TIMESTAMP
```

## 關聯類型

| 類型 | 適用時機 | 實作 |
|------|----------|------|
| **一對一** | 擴展資料 | 帶 FK 的獨立資料表 |
| **一對多** | 父子關係 | 子資料表上的 FK |
| **多對多** | 雙方都有多個 | 關聯資料表 |

## 外鍵 ON DELETE

```
├── CASCADE → 與父記錄一起刪除子記錄
├── SET NULL → 子記錄變為孤兒
├── RESTRICT → 如有子記錄則阻止刪除
└── SET DEFAULT → 子記錄取預設值
```
