---
name: mcp-builder
description: MCP（Model Context Protocol）伺服器建構原則。工具設計、資源模式、最佳實踐。
allowed-tools: Read, Write, Edit, Glob, Grep
---

# MCP 建構器

> 建構 MCP 伺服器的原則。

---

## 1. MCP 概覽

### 什麼是 MCP？

Model Context Protocol — 連接 AI 系統與外部工具和資料來源的標準。

### 核心概念

| 概念 | 用途 |
|------|------|
| **工具（Tools）** | AI 可以呼叫的函式 |
| **資源（Resources）** | AI 可以讀取的資料 |
| **提示（Prompts）** | 預定義的提示範本 |

---

## 2. 伺服器架構

### 專案結構

```
my-mcp-server/
├── src/
│   └── index.ts      # 主要入口
├── package.json
└── tsconfig.json
```

### 傳輸類型

| 類型 | 用途 |
|------|------|
| **Stdio** | 本地、CLI 基礎 |
| **SSE** | Web 基礎、串流 |
| **WebSocket** | 即時、雙向 |

---

## 3. 工具設計原則

### 好的工具設計

| 原則 | 描述 |
|------|------|
| 清晰命名 | 動作導向（get_weather、create_user）|
| 單一用途 | 做一件事做好 |
| 驗證輸入 | 帶型別和描述的 Schema |
| 結構化輸出 | 可預測的回應格式 |

### 輸入 Schema 設計

| 欄位 | 必要？ |
|------|--------|
| Type | 是 — object |
| Properties | 定義每個參數 |
| Required | 列出必要參數 |
| Description | 人類可讀 |

---

## 4. 資源模式

### 資源類型

| 類型 | 用途 |
|------|------|
| 靜態 | 固定資料（設定、文件）|
| 動態 | 按需生成 |
| 範本 | 帶參數的 URI |

### URI 模式

| 模式 | 範例 |
|------|------|
| 固定 | `docs://readme` |
| 參數化 | `users://{userId}` |
| 集合 | `files://project/*` |

---

## 5. 錯誤處理

### 錯誤類型

| 情況 | 回應 |
|------|------|
| 無效參數 | 驗證錯誤訊息 |
| 找不到 | 清晰的「找不到」|
| 伺服器錯誤 | 通用錯誤，記錄細節 |

### 最佳實踐

- 回傳結構化錯誤
- 不要暴露內部細節
- 記錄以供除錯
- 提供可操作的訊息

---

## 6. 多模態處理

### 支援的類型

| 類型 | 編碼 |
|------|------|
| 文字 | 純文字 |
| 圖片 | Base64 + MIME 類型 |
| 檔案 | Base64 + MIME 類型 |

---

## 7. 安全原則

### 輸入驗證

- 驗證所有工具輸入
- 清理使用者提供的資料
- 限制資源存取

### API 金鑰

- 使用環境變數
- 不要記錄密鑰
- 驗證權限

---

## 8. 設定

### Claude Desktop 設定

| 欄位 | 用途 |
|------|------|
| command | 要執行的可執行檔 |
| args | 指令參數 |
| env | 環境變數 |

---

## 9. 測試

### 測試類別

| 類型 | 重點 |
|------|------|
| 單元 | 工具邏輯 |
| 整合 | 完整伺服器 |
| 契約 | Schema 驗證 |

---

## 10. 最佳實踐檢查清單

- [ ] 清晰、動作導向的工具名稱
- [ ] 帶描述的完整輸入 Schema
- [ ] 結構化 JSON 輸出
- [ ] 所有情況的錯誤處理
- [ ] 輸入驗證
- [ ] 基於環境的設定
- [ ] 用於除錯的日誌

---

> **記住：** MCP 工具應該簡單、專注且文件完善。AI 依賴描述來正確使用它們。
