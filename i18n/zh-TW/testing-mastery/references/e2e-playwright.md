# E2E 與 Playwright 測試

> 發現並測試一切。不留下任何未測試的關鍵路線。

---

## 深度稽核方法

### 先發現

| 目標 | 如何找到 |
|------|----------|
| 路由 | 掃描 app/、pages/、路由檔案 |
| API 端點 | Grep HTTP 方法 |
| 元件 | 找到元件目錄 |
| 功能 | 閱讀文件 |

### 系統化測試

1. **映射** — 列出所有路由/API
2. **掃描** — 驗證它們有回應
3. **測試** — 覆蓋關鍵路徑

---

## E2E 測試原則

### 測試什麼

| 優先級 | 測試 |
|--------|------|
| 1 | 正常路徑使用者流程 |
| 2 | 驗證流程 |
| 3 | 關鍵商業操作 |
| 4 | 錯誤處理 |

### 最佳實踐

| 實踐 | 原因 |
|------|------|
| 使用 data-testid | 穩定的選擇器 |
| 等待元素 | 避免不穩定測試 |
| 乾淨的狀態 | 獨立的測試 |
| 避免實作細節 | 測試使用者行為 |

---

## Playwright 核心概念

| 概念 | 用途 |
|------|------|
| Page Object Model | 封裝頁面邏輯 |
| Fixtures | 可重用的測試設定 |
| Assertions | 內建自動等待 |
| Trace Viewer | 除錯失敗 |

### 配置

| 設定 | 建議 |
|------|------|
| 重試 | CI 上 2 次 |
| Trace | on-first-retry |
| 截圖 | on-failure |
| 影片 | retain-on-failure |

---

## 視覺測試

### 何時使用

| 場景 | 價值 |
|------|------|
| 設計系統 | 高 |
| 行銷頁面 | 高 |
| 元件庫 | 中 |
| 動態內容 | 較低 |

### 策略
- 基線截圖
- 變更時比較
- 審查視覺差異
- 更新有意的變更

---

## API 測試覆蓋

| 領域 | 測試 |
|------|------|
| 狀態碼 | 200、400、404、500 |
| 回應結構 | 符合 schema |
| 錯誤訊息 | 對使用者友善 |
| 邊界案例 | 空值、大量、特殊字元 |

---

## CI 整合

### 流水線步驟
1. 安裝依賴
2. 安裝瀏覽器
3. 執行測試
4. 上傳產出物（trace、截圖）

### 平行化

| 策略 | 用途 |
|------|------|
| 依檔案 | Playwright 預設 |
| 分片（Sharding） | 大型套件 |
| Workers | 多瀏覽器 |

---

## 測試組織

### 檔案結構

```
tests/
├── e2e/           # 完整使用者流程
├── integration/   # API、資料
├── component/     # UI 單元
└── fixtures/      # 共享資料
```

### 命名慣例

| 模式 | 範例 |
|------|------|
| 依功能 | `login.spec.ts` |
| 描述性 | `user-can-checkout.spec.ts` |

---

> **記住：** E2E 測試成本高。只用於關鍵路徑。
