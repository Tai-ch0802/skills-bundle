# TDD 循環 — RED-GREEN-REFACTOR

> 先寫測試，再寫程式碼。

---

## TDD 循環

```
🔴 RED → 撰寫失敗的測試
    ↓
🟢 GREEN → 撰寫最少的程式碼讓測試通過
    ↓
🔵 REFACTOR → 改善程式碼品質
    ↓
   重複...
```

---

## TDD 三大法則

1. 只為了讓失敗的測試通過而撰寫生產程式碼
2. 只撰寫足以證明失敗的測試
3. 只撰寫足以讓測試通過的程式碼

---

## RED 階段

### 撰寫什麼

| 焦點 | 範例 |
|------|------|
| 行為 | "should add two numbers" |
| 邊界案例 | "should handle empty input" |
| 錯誤狀態 | "should throw for invalid data" |

### 規則
- 測試必須先失敗
- 測試名稱描述預期行為
- 每個測試一個斷言（理想情況）

---

## GREEN 階段

| 原則 | 意義 |
|------|------|
| **YAGNI** | 你不會需要它 |
| **最簡單的事** | 撰寫通過測試的最少程式碼 |
| **不優化** | 只要能動就好 |

### 規則
- 不撰寫不需要的程式碼
- 還不優化
- 通過測試，僅此而已

---

## REFACTOR 階段

| 領域 | 行動 |
|------|------|
| 重複 | 提取共用程式碼 |
| 命名 | 讓意圖更清晰 |
| 結構 | 改善組織 |
| 複雜度 | 簡化邏輯 |

### 規則
- 所有測試必須保持綠燈
- 小幅漸進式變更
- 每次重構後提交

---

## 何時使用 TDD

| 場景 | TDD 價值 |
|------|----------|
| 新功能 | 高 |
| Bug 修復 | 高（先寫測試） |
| 複雜邏輯 | 高 |
| 探索性 | 低（先 spike，再 TDD） |
| UI 佈局 | 低 |

---

## 測試優先順序

| 優先級 | 測試類型 |
|--------|----------|
| 1 | 正常路徑（Happy path） |
| 2 | 錯誤案例 |
| 3 | 邊界案例 |
| 4 | 效能 |

---

## 反模式

| ❌ 不要 | ✅ 應該 |
|---------|---------|
| 跳過 RED 階段 | 先看測試失敗 |
| 之後才寫測試 | 先寫測試 |
| 一開始就過度設計 | 保持簡單 |
| 多個斷言 | 每個測試一個行為 |
| 測試實作 | 測試行為 |

---

## AI 增強的 TDD

### 多代理模式

| 代理 | 角色 |
|------|------|
| 代理 A | 撰寫失敗的測試（RED） |
| 代理 B | 實作讓測試通過（GREEN） |
| 代理 C | 優化（REFACTOR） |
