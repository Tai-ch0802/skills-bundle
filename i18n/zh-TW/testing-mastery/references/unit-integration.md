# 單元與整合測試模式

> 建立可靠測試套件的原則。

---

## 單元測試原則

### 良好的單元測試（F.I.R.S.T.）

| 原則 | 意義 |
|------|------|
| **快速（Fast）** | 每個 < 100ms |
| **隔離（Isolated）** | 無外部依賴 |
| **可重複（Repeatable）** | 每次結果相同 |
| **自我驗證（Self-checking）** | 不需人工驗證 |
| **及時（Timely）** | 隨程式碼一起撰寫 |

### 應該測試什麼

| 測試 | 不測試 |
|------|--------|
| 商業邏輯 | 框架程式碼 |
| 邊界案例 | 第三方函式庫 |
| 錯誤處理 | 簡單的 getter |

---

## 整合測試原則

### 測試什麼

| 領域 | 焦點 |
|------|------|
| API 端點 | 請求/回應 |
| 資料庫 | 查詢、交易 |
| 外部服務 | 契約 |

### 設定/拆卸

| 階段 | 行動 |
|------|------|
| Before All | 連接資源 |
| Before Each | 重設狀態 |
| After Each | 清理 |
| After All | 斷開連接 |

---

## Mocking 原則

### 何時 Mock

| 需要 Mock | 不要 Mock |
|-----------|-----------|
| 外部 API | 被測試的程式碼 |
| 資料庫（單元） | 簡單依賴 |
| 時間/隨機 | 純函式 |
| 網路 | 記憶體內儲存 |

### Mock 類型

| 類型 | 用途 |
|------|------|
| Stub | 回傳固定值 |
| Spy | 追蹤呼叫 |
| Mock | 設定預期 |
| Fake | 簡化的實作 |

---

## 測試資料策略

| 方法 | 用途 |
|------|------|
| 工廠（Factories） | 產生測試資料 |
| 固定資料（Fixtures） | 預定義的資料集 |
| 建構器（Builders） | 流暢的物件建立 |

### 原則
- 使用真實的資料
- 隨機化非必要值（faker）
- 共享常用的固定資料
- 保持資料最小化

---

## 測試組織

### 命名

| 模式 | 範例 |
|------|------|
| Should 行為 | "should return error when..." |
| When 條件 | "when user not found..." |
| Given-when-then | "given X, when Y, then Z" |

### 分組

| 層級 | 用途 |
|------|------|
| describe | 群組相關測試 |
| it/test | 個別案例 |
| beforeEach | 共通設定 |

---

## 最佳實踐

| 實踐 | 原因 |
|------|------|
| 每個測試一個斷言 | 清楚的失敗原因 |
| 獨立的測試 | 無順序依賴 |
| 快速測試 | 經常執行 |
| 描述性名稱 | 自我文件化 |
| 清理 | 避免副作用 |
