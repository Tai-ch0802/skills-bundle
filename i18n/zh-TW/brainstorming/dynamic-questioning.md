# 動態問題生成

> **原則：** 問題的目的不是收集資料 — 而是**揭示架構後果**。
>
> 每個問題必須連結到一個影響成本、複雜度或時程的具體實作決策。

---

## 🧠 核心原則

### 1. 問題揭示後果

好的問題不是「你想要什麼顏色？」而是：

```markdown
❌ 差：「什麼驗證方式？」
✅ 好：「使用者應該用 email/密碼還是社交登入？

   影響：
   - Email/密碼 → 需要密碼重設、雜湊、2FA 基礎設施
   - 社交 → OAuth 提供者、使用者個人資料對應、較少控制

   權衡：安全性 vs. 開發時間 vs. 使用者摩擦」
```

### 2. 情境先於內容

先了解這個請求**在哪裡**：

| 情境 | 問題重點 |
|------|----------|
| **全新專案** | 基礎決策：技術堆疊、託管、規模 |
| **功能新增** | 整合點、現有模式、破壞性變更 |
| **重構** | 為什麼重構？效能？可維護性？什麼壞了？ |
| **除錯** | 症狀 → 根本原因 → 重現路徑 |

### 3. 最少可行問題

**原則：** 每個問題必須排除實作道路的分岔。

```
問題前：
├── 路徑 A：做 X（5 分鐘）
├── 路徑 B：做 Y（15 分鐘）
└── 路徑 C：做 Z（1 小時）

問題後：
└── 確認路徑：做 X（5 分鐘）
```

如果一個問題不能減少實作路徑 → **刪除它**。

### 4. 問題生成資料而非假設

```markdown
❌ 假設：「使用者可能想用 Stripe 做支付」
✅ 問題：「哪個支付提供者適合你的需求？

   Stripe → 最佳文件、2.9% + $0.30、以美國為中心
   LemonSqueezy → 交易商角色、5% + $0.50、全球稅務
   Paddle → 複雜定價、處理歐盟 VAT、企業導向」
```

---

## 📋 問題生成演算法

```
輸入：使用者請求 + 情境（全新/功能/重構/除錯）
│
├── 步驟 1：解析請求
│   ├── 提取領域（電商、驗證、即時、CMS 等）
│   ├── 提取功能（明確和隱含的）
│   └── 提取規模指標（使用者、資料量、頻率）
│
├── 步驟 2：識別決策點
│   ├── 什麼必須在編碼前決定？（阻塞性）
│   ├── 什麼可以稍後決定？（可延遲）
│   └── 什麼有架構影響？（高槓桿）
│
├── 步驟 3：生成問題（優先順序）
│   ├── P0：阻塞性決策（沒有答案無法繼續）
│   ├── P1：高槓桿（影響 >30% 的實作）
│   ├── P2：中槓桿（影響特定功能）
│   └── P3：錦上添花（邊界情況、最佳化）
│
└── 步驟 4：格式化每個問題
    ├── 什麼：清晰的問題
    ├── 為什麼：對實作的影響
    ├── 選項：權衡（不只是 A vs B）
    └── 預設：使用者不回答時怎麼辦
```

---

## 🎯 領域特定問題庫

### 電商

| 問題 | 為什麼重要 | 權衡 |
|------|------------|------|
| **單一或多商家？** | 多商家 → 佣金邏輯、商家後台、分帳支付 | +營收、-複雜度 |
| **庫存追蹤？** | 需要庫存表、預留邏輯、低庫存警報 | +準確性、-開發時間 |
| **數位或實體產品？** | 數位 → 下載連結、無物流 | 實體 → 物流 API、追蹤 |
| **訂閱或一次性？** | 訂閱 → 定期計費、催款、按比例計算 | +營收、-複雜度 |

### 驗證

| 問題 | 為什麼重要 | 權衡 |
|------|------------|------|
| **需要社交登入？** | OAuth 提供者 vs 密碼重設基礎設施 | +UX、-控制 |
| **基於角色的權限？** | RBAC 表、策略執行、管理 UI | +安全性、-開發時間 |
| **需要 2FA？** | TOTP/SMS 基礎設施、備用碼、恢復流程 | +安全性、-UX 摩擦 |
| **Email 驗證？** | 驗證令牌、Email 服務、重發邏輯 | +安全性、-註冊摩擦 |

### 即時

| 問題 | 為什麼重要 | 權衡 |
|------|------------|------|
| **WebSocket 或輪詢？** | WS → 伺服器擴展、連線管理 | 輪詢 → 更簡單、較高延遲 |
| **預期併發使用者？** | <100 → 單一伺服器、>1000 → Redis pub/sub、>10k → 專用基礎設施 | +規模、-複雜度 |
| **訊息持久化？** | 歷史表、儲存成本、分頁 | +UX、-儲存 |
| **暫時或持久？** | 暫時 → 記憶體內、持久 → 發送前寫入資料庫 | +可靠性、-延遲 |

### 內容/CMS

| 問題 | 為什麼重要 | 權衡 |
|------|------------|------|
| **富文字或 Markdown？** | 富文字 → 清理、XSS 風險 | Markdown → 簡單、無所見即所得 |
| **草稿/發布工作流？** | 狀態欄位、排程任務、版本控制 | +控制、-複雜度 |
| **媒體處理？** | 上傳端點、儲存、最佳化 | +功能、-開發時間 |
| **多語言？** | i18n 表、翻譯 UI、備援邏輯 | +觸及範圍、-複雜度 |

---

## 📐 動態問題範本

```markdown
根據你對 [領域] [功能] 的請求：

## 🔴 關鍵（阻塞性決策）

### 1. **[決策點]**

**問題：** [清晰、具體的問題]

**為什麼重要：**
- [解釋架構後果]
- [影響：成本 / 複雜度 / 時程 / 規模]

**選項：**
| 選項 | 優點 | 缺點 | 最適合 |
|------|------|------|--------|
| A | [優勢] | [劣勢] | [使用案例] |
| B | [優勢] | [劣勢] | [使用案例] |

**若未指定：** [預設選擇 + 理由]

---

## 🟡 高槓桿（影響實作）

### 2. **[決策點]**
[相同格式]

---

## 🟢 錦上添花（邊界情況）

### 3. **[決策點]**
[相同格式]
```

---

## 🔄 迭代式提問

### 第一輪（3-5 個問題）
專注於**阻塞性決策**。沒有答案不要繼續。

### 第二輪（初始實作後）
隨著模式浮現，詢問：
- 「這個功能暗示了 [X]。我們應該現在處理 [邊界情況] 還是延後？」
- 「我們使用了 [模式 A]。[功能 B] 也應該遵循同樣的模式嗎？」

### 第三輪（最佳化）
功能正常運作後：
- 「[X] 處有效能瓶頸。現在最佳化還是目前可接受？」
- 「重構 [Y] 以提升可維護性，還是照原樣發布？」

---

## 🎯 原則回顧

1. **每個問題 = 架構決策** → 不是資料收集
2. **展示權衡** → 使用者理解後果
3. **優先阻塞性決策** → 沒有答案無法繼續
4. **提供預設** → 如果使用者不回答，我們仍然繼續
5. **領域感知** → 電商問題 ≠ 驗證問題 ≠ 即時問題
6. **迭代式** → 隨著實作中模式浮現，產生更多問題
