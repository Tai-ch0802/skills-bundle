---
name: tdd-workflow
description: 測試驅動開發工作流程原則。RED-GREEN-REFACTOR 循環。
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
---

# TDD 工作流程

> 先寫測試，後寫程式碼。

---

## 1. TDD 循環

```
🔴 RED → 寫失敗的測試
    ↓
🟢 GREEN → 寫最少的程式碼讓測試通過
    ↓
🔵 REFACTOR → 改善程式碼品質
    ↓
   重複...
```

---

## 2. TDD 三大定律

1. 僅為使失敗的測試通過而寫生產程式碼
2. 僅寫足以證明失敗的測試
3. 僅寫足以使測試通過的程式碼

---

## 3. RED 階段原則

### 要寫什麼

| 焦點 | 範例 |
|------|------|
| 行為 | 「should add two numbers」|
| 邊界情況 | 「should handle empty input」|
| 錯誤狀態 | 「should throw for invalid data」|

### RED 階段規則

- 測試必須先失敗
- 測試名稱描述預期行為
- 每個測試一個斷言（理想情況）

---

## 4. GREEN 階段原則

### 最少程式碼

| 原則 | 意義 |
|------|------|
| **YAGNI** | 你不會需要它 |
| **最簡單的事** | 寫最少的來通過 |
| **不最佳化** | 只讓它運作 |

### GREEN 階段規則

- 不寫不需要的程式碼
- 還不要最佳化
- 通過測試，僅止於此

---

## 5. REFACTOR 階段原則

### 要改善什麼

| 領域 | 動作 |
|------|------|
| 重複 | 抽取共用程式碼 |
| 命名 | 讓意圖清晰 |
| 結構 | 改善組織 |
| 複雜度 | 簡化邏輯 |

### REFACTOR 規則

- 所有測試必須保持綠色
- 小幅增量變更
- 每次重構後提交

---

## 6. AAA 模式

每個測試遵循：

| 步驟 | 用途 |
|------|------|
| **Arrange** | 設置測試資料 |
| **Act** | 執行受測程式碼 |
| **Assert** | 驗證預期結果 |

---

## 7. 何時使用 TDD

| 情境 | TDD 價值 |
|------|----------|
| 新功能 | 高 |
| Bug 修復 | 高（先寫測試）|
| 複雜邏輯 | 高 |
| 探索性 | 低（先做 spike，再 TDD）|
| UI 佈局 | 低 |

---

## 8. 測試優先順序

| 優先 | 測試類型 |
|------|----------|
| 1 | 正常路徑 |
| 2 | 錯誤情況 |
| 3 | 邊界情況 |
| 4 | 效能 |

---

## 9. 反模式

| ❌ 不要 | ✅ 要 |
|---------|-------|
| 跳過 RED 階段 | 先看測試失敗 |
| 事後寫測試 | 事前寫測試 |
| 初始過度工程 | 保持簡單 |
| 多個斷言 | 每個測試一個行為 |
| 測試實作 | 測試行為 |

---

## 10. AI 增強 TDD

### 多代理模式

| 代理 | 角色 |
|------|------|
| 代理 A | 寫失敗的測試（RED）|
| 代理 B | 實作以通過（GREEN）|
| 代理 C | 最佳化（REFACTOR）|

---

> **記住：** 測試就是規格。如果你不能寫測試，你就不理解需求。
