# API 安全測試

> API 安全測試原則。OWASP API Top 10、驗證、授權測試。

---

## OWASP API 安全 Top 10

| 弱點 | 測試重點 |
|------|----------|
| **API1: BOLA** | 存取其他使用者的資源 |
| **API2: 驗證失效** | JWT、Session、憑證 |
| **API3: 屬性授權** | 大量賦值、資料暴露 |
| **API4: 資源消耗** | 速率限制、DoS |
| **API5: 功能授權** | 管理端點、角色繞過 |
| **API6: 業務流程** | 邏輯濫用、自動化 |
| **API7: SSRF** | 內部網路存取 |
| **API8: 設定錯誤** | 除錯端點、CORS |
| **API9: 資產清單** | 影子 API、舊版本 |
| **API10: 不安全消費** | 第三方 API 信任 |

---

## 驗證測試

### JWT 測試

| 檢查項目 | 測試內容 |
|----------|----------|
| 演算法 | None、演算法混淆 |
| 密鑰 | 弱密鑰、暴力破解 |
| 聲明 | 過期、發行者、對象 |
| 簽名 | 竄改、金鑰注入 |

### Session 測試

| 檢查項目 | 測試內容 |
|----------|----------|
| 生成 | 可預測性 |
| 儲存 | 客戶端安全 |
| 過期 | 逾時執行 |
| 失效 | 登出有效性 |

---

## 授權測試

| 測試類型 | 方法 |
|----------|------|
| **水平** | 存取同級使用者的資料 |
| **垂直** | 存取更高權限功能 |
| **情境** | 在允許範圍外存取 |

### BOLA/IDOR 測試

1. 識別請求中的資源 ID
2. 使用使用者 A 的 session 擷取請求
3. 使用使用者 B 的 session 重放
4. 檢查是否有未授權存取

---

## 輸入驗證測試

| 注入類型 | 測試重點 |
|----------|----------|
| SQL | 查詢操控 |
| NoSQL | 文件查詢 |
| 指令 | 系統指令 |
| LDAP | 目錄查詢 |

**方法：** 測試所有參數，嘗試型別強制轉換，測試邊界值，檢查錯誤訊息。

---

## 速率限制測試

| 面向 | 檢查 |
|------|------|
| 存在性 | 是否有任何限制？ |
| 繞過 | 標頭、IP 輪換 |
| 範圍 | 每使用者、每 IP、全域 |

**繞過技巧：** X-Forwarded-For、不同 HTTP 方法、大小寫變化、API 版本控制。

---

## GraphQL 安全

| 測試 | 重點 |
|------|------|
| 自省查詢 | Schema 洩露 |
| 批次 | 查詢 DoS |
| 巢狀 | 基於深度的 DoS |
| 授權 | 欄位級存取 |

---

## 安全測試檢查清單

**驗證：**
- [ ] 測試繞過
- [ ] 檢查憑證強度
- [ ] 驗證令牌安全

**授權：**
- [ ] 測試 BOLA/IDOR
- [ ] 檢查權限提升
- [ ] 驗證功能存取

**輸入：**
- [ ] 測試所有參數
- [ ] 檢查注入攻擊

**設定：**
- [ ] 檢查 CORS
- [ ] 驗證標頭
- [ ] 測試錯誤處理

---

> **記住：** API 是現代應用程式的骨幹。像攻擊者一樣測試它們。
