# 代理協調

> App Builder 如何協調專家代理。

## 代理管線

```
┌─────────────────────────────────────────────────────────────┐
│                   APP BUILDER（協調器）                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     專案規劃器                                │
│  • 任務分解                                                   │
│  • 依賴圖                                                     │
│  • 檔案結構規劃                                               │
│  • 在專案根目錄建立 {task-slug}.md（必要）                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              檢查點：計畫驗證                                  │
│  🔴 驗證：{task-slug}.md 存在於專案根目錄嗎？                  │
│  🔴 如果否 → 停止 → 先建立計畫檔案                            │
│  🔴 如果是 → 繼續到專家代理                                   │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ 資料庫           │ │ 後端             │ │ 前端             │
│ 架構師           │ │ 專家             │ │ 專家             │
│                 │ │                 │ │                 │
│ • Schema 設計   │ │ • API 路由      │ │ • 元件           │
│ • 遷移          │ │ • 控制器        │ │ • 頁面           │
│ • 種子資料      │ │ • 中介軟體      │ │ • 樣式           │
└─────────────────┘ └─────────────────┘ └─────────────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 平行階段（可選）                               │
│  • 安全稽核員 → 弱點檢查                                      │
│  • 測試工程師 → 單元測試                                      │
│  • 效能最佳化師 → 打包分析                                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     DevOps 工程師                             │
│  • 環境設置                                                   │
│  • 預覽部署                                                   │
│  • 健康檢查                                                   │
└─────────────────────────────────────────────────────────────┘
```

## 執行順序

| 階段 | 代理 | 平行？ | 前置條件 | 檢查點 |
|------|------|--------|----------|--------|
| 0 | 蘇格拉底式問答 | ❌ | — | ✅ 問 3 個問題 |
| 1 | 專案規劃器 | ❌ | 問題已回答 | ✅ **PLAN.md 已建立** |
| 1.5 | **計畫驗證** | ❌ | PLAN.md 存在 | ✅ **檔案存在於根目錄** |
| 2 | 資料庫架構師 | ❌ | 計畫就緒 | Schema 已定義 |
| 3 | 後端專家 | ❌ | Schema 就緒 | API 路由已建立 |
| 4 | 前端專家 | ✅ | API 就緒（部分）| UI 元件就緒 |
| 5 | 安全稽核員、測試工程師 | ✅ | 程式碼就緒 | 測試和稽核通過 |
| 6 | DevOps 工程師 | ❌ | 所有程式碼就緒 | 部署就緒 |

> 🔴 **關鍵：** 階段 1.5 是必要的。沒有 PLAN.md 驗證，任何專家代理都不能繼續。
